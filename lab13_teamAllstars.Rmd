---
title: "lab13"
author: "allstars"
date: "11/19/2019"
output: html_document
---

## Individual Sections

### Eugene Miller

#Question: Is there a correlation between energy produced per person and chance that a person will be displaced by flooding? 

```{r, setup}
library(tidyverse)
library(gapminder)

energy_capita <- read_csv('energy_production_per_person.csv')
flood_affected <- read_csv('flood_affected_annual_number.csv')

a <- which(colnames(energy_capita)=="1960")
b <- which(colnames(energy_capita)=="2010")

energy_capita <- energy_capita %>% 
  gather(a:b, key = "Year", value = "Energy Per Capita") %>%
  filter(!is.na(`Energy Per Capita`))

a <- which(colnames(flood_affected)=="1970")
b <- which(colnames(flood_affected)=="2008")

flood_affected <- flood_affected %>% 
  gather(a:b, key = "Year", value = "Flood Affected") %>% 
  filter(!is.na(`Flood Affected`))

data <- full_join(flood_affected,energy_capita, by = c("country", "Year")) %>%
  filter(!is.na(`Energy Per Capita`)) %>% 
  filter(!is.na(`Flood Affected`))

data$Year <- as.numeric(data$Year)

gap_new <- gapminder %>% 
  select(`country`, `year`, `pop`) %>%
  rename("Year" = `year`)

data <- full_join(data, gap_new, by = c("country", "Year")) %>%
  filter(!is.na(pop)) %>% 
  mutate(Flood_cap = `Flood Affected`/`pop`) %>% 
  filter(!is.na(Flood_cap))

data %>% map(summary)

r_flood <- map(data$Flood_cap, function(x) rnorm(10, x, 1))
r_energy <- map(data$`Energy Per Capita`, function(x) rnorm (10, x, 1))

 r_test <- tribble(
  ~flood, ~energy,
  #--|--|----
)

 vector <- character(length(r_flood))
 vector1 <- character(length(r_flood))
 
 for (i in seq_along(r_flood)){
    flood_samp <- r_flood[[i]][[sample(1:10,1)]]
    energy_samp <- r_energy[[i]][[sample(1:10,1)]]
    flood_char <- as.character(flood_samp)
    energy_char <- as.character(energy_samp)
    vector[i] <- flood_char
    vector1[i] <- energy_char
 }

```



```{r, message = F, echo = T, message = F, eval = T}

perm_cor <- function(perms = 1000, x, y)
{
  vec <- numeric(perms)
  for (i in c(1:perms))
  {
    r_Y <- sample(y)
    vec[i] <- cor(x, r_Y)
  }
  return(vec)
}


core <- cor( data$`Energy Per Capita`, data$`Flood_cap`)
corellate <- perm_cor(perms = 100000, data$`Energy Per Capita`,  data$`Flood_cap`)


ggplot() + aes(corellate)+ geom_histogram(binwidth=.01, colour="black", fill="white") + geom_vline(mapping =aes(xintercept=core), color = "red") + labs(x = "Correlation Tests")

p_value <- sum(corellate < core)/100000
p_value
```

## Emily Archambault

# Question: Is the annual amount of hydro power generated in the US correlated with annual CO2 emissions?

```{r, echo=FALSE, messages = FALSE}
library(tidyverse)

hydro <- read_csv("hydro_power_generation_total.csv")
CO2 <-  read_csv("yearly_co2_emissions_1000_tonnes.csv")

ushydro <- hydro %>%
  filter(country == "United States") %>%
  select("1975":"2011") %>% 
  gather("1975":"2011", key = "year", value = "hydro energy produced")

usCO2 <- CO2 %>% 
  filter(country == "United States") %>% 
  select("1975":"2011") %>%
  gather("1975":"2011", key = "year", value = "CO2 Emissions")

hydroco2 <- ushydro%>%
  left_join(usCO2, by = "year")

perm_cor <- function(perms = 1000, x, y)
{
  vec <- numeric(perms)
  for (i in c(1:perms))
  {
    r_Y <- sample(y)
    vec[i] <- cor(x, r_Y)
  }
  return(vec)
}

co_hydro_corr <- perm_cor(1000, usCO2$`CO2 Emissions`, ushydro$`hydro energy produced`)
cortest <- cor(usCO2$`CO2 Emissions`, ushydro$`hydro energy produced`)

ggplot() + aes(co_hydro_corr)+ geom_histogram(binwidth=.07, colour="black", fill="white") + 
  geom_vline(xintercept = cortest, color="red") + labs(x = "CO2 and Hydro Power Correlation")
```

The null hypothesis is that there is no correlation between CO2 emissions and hydro power generated (0), while the alternative hypothesis is that there is a correlation (H > or < 0).

I used a corellation test between the two variables as my test statistic.

```{r, echo = FALSE , message=FALSE}
p_value_corr <- 1 - sum(co_hydro_corr < cortest)/1000
corr_percentile <- sum(co_hydro_corr < cortest)/length(co_hydro_corr) *100
```

The real data summary statistic falls in the `r corr_percentile`th percentile. With this, and a p value of `r p_value_corr` , I'm concluding that there is not a significant correlation between the annual CO2 emissions and the annual hydro power generated in the US. I thought initally, as the amount of hydro power increased, there may be a noticeable decrease in the amount of CO2, giving a negative correlation, but it appears that there is not a significant correlation there.

# Map Function

```{r, warning = FALSE}
map_dbl(hydroco2, mean)
```

This map function calculated the mean of each column in my hydroco2 dataset, giving the mean of annual CO2 emissions from 1975-2011, and the mean of annual hydro power generated in the same time frame. It returned NA for the year column because it was not numeric or logical (and it doesn't make sense to find the mean year anyway.)
